# 當前工作上下文

## 專案狀態
遊客行為系統已完成基礎實作，包含移動、狀態管理和滿意度整合。目前將轉向設施系統的開發。

## 最近更新
- 完成遊客行為系統實作
  - Visitor 類別完整實現
  - 狀態管理系統（IDLE, MOVING, QUEUING, PLAYING, LEAVING）
  - 路徑尋找和避障整合
  - 滿意度系統整合
  - 完整測試覆蓋
- 規劃開始設施系統開發
  - 基礎設施類別設計
  - 容量管理系統
  - 排隊機制實現

## 進行中的工作

1. 設施系統開發（準備開始）
   - 設施基礎類別設計
   - 容量與排隊管理
   - 營運數據收集
   - 效能監控實現
   - 設施互動介面
   - 單元測試建置

2. 系統整合規劃
   - 遊客行為系統與現有系統整合
     - 路徑系統整合
     - 滿意度系統整合
   - 狀態管理優化
   - 效能監控實現

## 待解決問題
- [ ] 設施系統設計與實現
  - [ ] 設施類型定義
  - [ ] 建造介面設計
  - [ ] 容量管理邏輯
  - [ ] 排隊系統實作
- [ ] 系統整合需求
  - [ ] 與遊客系統整合
  - [ ] 效能監控實現
  - [ ] UI/UX 設計

## 技術決策
最近做出的關鍵技術決策：
1. 遊客行為系統使用狀態機模式
2. 實現線性插值移動算法
3. 優化路徑檢查機制
4. 改進滿意度計算系統
5. 添加完整的單元測試

## 風險評估
| 風險 | 影響 | 緩解措施 |
|------|------|----------|
| 滿意度計算效能 | 高 | 優化計算頻率，使用緩存 |
| 路徑規劃複雜度 | 中 | 實現簡化的尋路算法 |
| 狀態更新頻率 | 中 | 批次處理更新操作 |
| 介面響應延遲 | 低 | 實現狀態預測機制 |

## 下一步行動

1. 設施系統開發
   - 設施類型設計
   - 建造系統實現
   - 容量管理系統
   - 排隊機制開發

2. 介面開發
   - 遊客資訊面板
   - 設施管理介面
   - 建造工具欄
   - 狀態監控儀表板

3. 效能優化
   - Canvas 渲染優化
   - 狀態更新機制
   - 路徑計算優化
   - 記憶體管理

## 參考資源
- React 效能優化指南
- Canvas 遊戲開發教程
- 路徑演算法文獻
- Redux 狀態管理最佳實踐

## 備註
- 遊客行為系統已完成基礎功能
- 設施系統需要完整的規劃
- 注意系統整合的效能影響
- 保持代碼的可維護性
- 持續完善測試覆蓋
